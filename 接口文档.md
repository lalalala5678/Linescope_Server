

# 0. 传输与通用规范

## 0.1 传输层

* **传输协议**：TCP（长连接或短连接均可）。 MQTT协议
* **消息边界**：靠帧内 `Packet_Length` 明确；接收端需按长度切分粘包/拆包。

## 0.2 统一帧结构（所有报文通用）

```
+------------------+--------+----------------------------------------------+
| 字段名           | 字节数 | 说明                                         |
+------------------+--------+----------------------------------------------+
| Sync             | 2      | 固定 0x5A 0xA5（小端值 0x5AA5）               |
| Packet_Length    | 2      | 仅 “Content” 的长度（≤ 1417 字节）            |
| CMD_ID           | 17     | 设备/通信 ID（17 字节）                       |
| Frame_Type       | 1      | 帧类型（如：上送/应答；数值按协议枚举）        |
| Packet_Type      | 1      | 报文类型（气象/倾斜/温度/心跳；枚举）          |
| Frame_No         | 1      | 帧序号（发送端自增，0~255 循环）               |
| Content          | N      | 业务体（见各节）                               |
| CRC16            | 2      | CRC-16，小端存放                               |
| End              | 1      | 固定 0x96                                     |
+------------------+--------+----------------------------------------------+
```

## 0.3 编码与时间

* **整数/浮点字节序**：除特别说明，均为**小端序**（低字节在前）。
* **浮点**：IEEE-754 单精度（4 字节）。
* **时间戳**：`Time_Stamp`/`Clocktime_Stamp` 为 `uint32` 世纪秒（Unix Epoch）。

## 0.4 CRC16

* **覆盖范围**：从 `Packet_Length`（含）到 `Content` 末尾（含）；**不含** `Sync`、`CRC16` 本身与 `End`。
* **写入顺序**：低字节在前（小端）。

## 0.5 请求-应答与重发

* **帧号回填**：应答帧的 `Frame_No` 必须等于对应请求/上送帧的 `Frame_No`。
* **监测数据类（气象/倾斜/导线温度）应答**：统一含 `Data_Status`（1B，`0xFF` 成功；`0x00` 失败）。
* **心跳类应答**：为**专用格式**（见 4.2），含 `Command_Status`、`Mode`、`Clocktime_Stamp`。
* **重发策略**：上送 30 s 未收到“成功”应答或收到失败应答→重发；最多 5 次。

## 0.6 默认上送周期

* 气象（3.1）：10 分钟
* 杆塔倾斜（3.2）：60 分钟
* 导线温度（3.5）：10 分钟
* 心跳（6.1）：**5 分钟**

---

> 当前系统仅部署气象、杆塔倾斜、导线温度三类监测设备及其心跳报文，以下章节仅针对这三类业务帧及对应应答帧进行定义。

# 1) C.3.1 气象数据报

默认上送周期：10 分钟。

## 1.1 上送帧（Packet_Type：气象）

| 序号 | 字段名                     | 字节数 | 类型 / 单位 / 精度            | 说明                                                         |
| ---- | -------------------------- | ------ | ----------------------------- | ------------------------------------------------------------ |
| 1    | Sync                       | 2      | 固定值                        | 帧头 `0x5AA5`                                                |
| 2    | Packet_Length              | 2      | uint16                        | 仅 `Content` 长度，≤1417 Byte                                |
| 3    | CMD_ID                     | 17     | bytes[17]                     | 状态监测装置通信 ID（17 位编码）                             |
| 4    | Frame_Type                 | 1      | uint8                         | 帧类型，参见附表 C8-1                                        |
| 5    | Packet_Type                | 1      | uint8                         | 报文类型：气象（参见附表 C8-2 枚举值）                       |
| 6    | Frame_No                   | 1      | uint8                         | 帧序号，发送端自增                                            |
| 7    | Component_ID               | 17     | bytes[17]                     | 被监测设备 ID（17 位编码）                                   |
| 8    | Time_Stamp                 | 4      | uint32（Unix Epoch）          | 采集时间，单位：秒                                           |
| 9    | Average_WindSpeed_10min    | 4      | float（m/s，0.1）             | 10 分钟平均风速                                              |
| 10   | Average_WindDirection_10min| 2      | uint16（°）                   | 10 分钟平均风向，0–360                                       |
| 11   | Max_WindSpeed              | 4      | float（m/s，0.1）             | 统计周期内最大风速                                           |
| 12   | Extreme_WindSpeed          | 4      | float（m/s，0.1）             | 极大风速（阵风）                                             |
| 13   | Standard_WindSpeed         | 4      | float（m/s，0.1）             | 对数风廓线折算后的标准状态风速                               |
| 14   | Air_Temperature            | 4      | float（℃，0.1）               | 气温                                                         |
| 15   | Humidity                   | 2      | uint16（%RH）                 | 相对湿度                                                     |
| 16   | Air_Pressure               | 4      | float（hPa，0.1）             | 气压                                                         |
| 17   | Precipitation              | 4      | float（mm，0.1）              | 降雨量                                                       |
| 18   | Precipitation_Intensity    | 4      | float（mm/min，0.1）          | 降水强度                                                     |
| 19   | Radiation_Intensity        | 2      | uint16（W/m²）                | 光辐射强度                                                   |
| 20   | CRC16                      | 2      | uint16                        | CRC-16 校验值（覆盖 Packet_Length 至 Content）               |
| 21   | End                        | 1      | 固定值                        | 帧尾 `0x96`                                                  |

## 1.2 应答帧（对气象上送）

| 序号 | 字段名        | 字节数 | 说明                                                         |
| ---- | ------------- | ------ | ------------------------------------------------------------ |
| 1    | Sync          | 2      | 帧头 `0x5AA5`                                                |
| 2    | Packet_Length | 2      | 仅 `Content`（本帧中仅含 `Data_Status`）长度                |
| 3    | CMD_ID        | 17     | 通信 ID                                                      |
| 4    | Frame_Type    | 1      | 帧类型，参见附表 C8-1                                        |
| 5    | Packet_Type   | 1      | 报文类型：气象应答（参见附表 C8-2）                          |
| 6    | Frame_No      | 1      | 必须回填请求帧的 `Frame_No`                                  |
| 7    | Data_Status   | 1      | `0xFF` 成功；`0x00` 失败                                     |
| 8    | CRC16         | 2      | CRC-16 校验值                                                |
| 9    | End           | 1      | 帧尾 `0x96`                                                  |

---

# 2) C.3.2 杆塔倾斜数据报

默认上送周期：60 分钟。

## 2.1 上送帧（Packet_Type：杆塔倾斜）

| 序号 | 字段名        | 字节数 | 类型 / 单位 / 精度      | 说明                                                  |
| ---- | ------------- | ------ | ----------------------- | ----------------------------------------------------- |
| 1    | Sync          | 2      | 固定值                  | 帧头 `0x5AA5`                                         |
| 2    | Packet_Length | 2      | uint16                  | 仅 `Content` 长度，≤1417 Byte                         |
| 3    | CMD_ID        | 17     | bytes[17]               | 状态监测装置通信 ID                                   |
| 4    | Frame_Type    | 1      | uint8                   | 帧类型，参见附表 C8-1                                 |
| 5    | Packet_Type   | 1      | uint8                   | 报文类型：杆塔倾斜（参见附表 C8-2）                   |
| 6    | Frame_No      | 1      | uint8                   | 帧序号                                                |
| 7    | Component_ID  | 17     | bytes[17]               | 被监测杆塔组件 ID                                     |
| 8    | Time_Stamp    | 4      | uint32（Unix Epoch）    | 采集时间                                              |
| 9    | Inclination   | 4      | float（mm/m，0.1）      | 综合倾斜度                                            |
| 10   | Inclination_X | 4      | float（mm/m，0.1）      | 顺线路向倾斜度                                        |
| 11   | Inclination_Y | 4      | float（mm/m，0.1）      | 横线路向倾斜度                                        |
| 12   | Angle_X       | 4      | float（°，0.01）        | 顺线路向倾斜角                                        |
| 13   | Angle_Y       | 4      | float（°，0.01）        | 横线路向倾斜角                                        |
| 14   | CRC16         | 2      | uint16                  | CRC-16 校验值                                         |
| 15   | End           | 1      | 固定值                  | 帧尾 `0x96`                                           |

## 2.2 应答帧（对杆塔倾斜上送）

| 序号 | 字段名        | 字节数 | 说明                                                         |
| ---- | ------------- | ------ | ------------------------------------------------------------ |
| 1    | Sync          | 2      | 帧头 `0x5AA5`                                                |
| 2    | Packet_Length | 2      | 仅 `Data_Status` 长度                                        |
| 3    | CMD_ID        | 17     | 通信 ID                                                      |
| 4    | Frame_Type    | 1      | 帧类型                                                       |
| 5    | Packet_Type   | 1      | 报文类型：杆塔倾斜应答                                       |
| 6    | Frame_No      | 1      | 回填请求帧 `Frame_No`                                        |
| 7    | Data_Status   | 1      | `0xFF` 成功；`0x00` 失败                                     |
| 8    | CRC16         | 2      | CRC-16 校验值                                                |
| 9    | End           | 1      | 帧尾 `0x96`                                                  |

---

# 3) C.3.5 导线温度数据报

默认上送周期：10 分钟。

## 3.1 上送帧（Packet_Type：导线温度）

| 序号 | 字段名           | 字节数 | 类型 / 单位 / 精度   | 说明                                                         |
| ---- | ---------------- | ------ | -------------------- | ------------------------------------------------------------ |
| 1    | Sync             | 2      | 固定值               | 帧头 `0x5AA5`                                                |
| 2    | Packet_Length    | 2      | uint16               | 仅 `Content` 长度，≤1417 Byte                                |
| 3    | CMD_ID           | 17     | bytes[17]            | 状态监测装置通信 ID                                          |
| 4    | Frame_Type       | 1      | uint8                | 帧类型，参见附表 C8-1                                        |
| 5    | Packet_Type      | 1      | uint8                | 报文类型：导线温度（参见附表 C8-2）                          |
| 6    | Frame_No         | 1      | uint8                | 帧序号                                                       |
| 7    | Component_ID     | 17     | bytes[17]            | 被监测导线组件 ID                                            |
| 8    | Unit_Sum         | 1      | uint8                | 采集单元总数，>0                                             |
| 9    | Unit_No          | 1      | uint8                | 当前采集单元序号，范围 1…Unit_Sum                           |
| 10   | Time_Stamp       | 4      | uint32（Unix Epoch） | 采集时间                                                     |
| 11   | Line_Temperature | 4      | float（℃，0.1）      | 对应单元导线温度                                             |
| 12   | CRC16            | 2      | uint16               | CRC-16 校验值                                                |
| 13   | End              | 1      | 固定值               | 帧尾 `0x96`                                                  |

> 对于多测点设备，`Unit_No` 一般按 1…`Unit_Sum` 逐条上送。

## 3.2 应答帧（对导线温度上送）

| 序号 | 字段名        | 字节数 | 说明                                                         |
| ---- | ------------- | ------ | ------------------------------------------------------------ |
| 1    | Sync          | 2      | 帧头 `0x5AA5`                                                |
| 2    | Packet_Length | 2      | 仅 `Data_Status` 长度                                        |
| 3    | CMD_ID        | 17     | 通信 ID                                                      |
| 4    | Frame_Type    | 1      | 帧类型                                                       |
| 5    | Packet_Type   | 1      | 报文类型：导线温度应答                                       |
| 6    | Frame_No      | 1      | 回填请求帧 `Frame_No`                                        |
| 7    | Data_Status   | 1      | `0xFF` 成功；`0x00` 失败                                     |
| 8    | CRC16         | 2      | CRC-16 校验值                                                |
| 9    | End           | 1      | 帧尾 `0x96`                                                  |

---

# 4) C.6.1 心跳数据报

默认上送周期：5 分钟。

## 4.1 上送帧（Packet_Type：心跳）

| 序号 | 字段名             | 字节数 | 类型 / 单位 / 精度      | 说明                                                                 |
| ---- | ------------------ | ------ | ----------------------- | -------------------------------------------------------------------- |
| 1    | Sync               | 2      | 固定值                  | 帧头 `0x5AA5`                                                        |
| 2    | Packet_Length      | 2      | uint16                  | 仅 `Content` 长度，≤1417 Byte                                       |
| 3    | CMD_ID             | 17     | bytes[17]               | 状态监测装置通信 ID                                                 |
| 4    | Frame_Type         | 1      | uint8                   | 帧类型，参见附表 C8-1                                               |
| 5    | Packet_Type        | 1      | uint8                   | 报文类型：心跳（参见附表 C8-2）                                     |
| 6    | Frame_No           | 1      | uint8                   | 帧序号                                                              |
| 7    | Clocktime_Stamp    | 4      | uint32（Unix Epoch）    | 当前时间                                                            |
| 8    | Battery_Voltage    | 4      | float（V，0.1）         | 电源电压                                                            |
| 9    | Operation_Temperature | 4   | float（℃，0.1）         | 工作温度                                                            |
| 10   | Battery_Capacity   | 4      | float（Ah，0.1）        | 电池剩余电量                                                        |
| 11   | FloatingCharge     | 1      | uint8                   | 浮充状态：`0x00` 充电；`0x01` 放电                                  |
| 12   | Total_Working_Time | 4      | uint32（h）             | 工作总时间                                                          |
| 13   | Working_Time       | 4      | uint32（h）             | 本次连续工作时间                                                    |
| 14   | Connection_State   | 1      | uint8                   | 连接状态：`0x00` 全部传感器正常；`0x01` 存在异常                    |
| 15   | Send_Flow          | 4      | uint32（Byte）          | 当月发送流量                                                        |
| 16   | Receive_Flow       | 4      | uint32（Byte）          | 当月接收流量                                                        |
| 17   | Protocol_Version   | 4      | bytes[4]                | 协议版本号，逐字节表示，如 `01 02 04 0A` → 1.2.4.10                 |
| 18   | CRC16              | 2      | uint16                  | CRC-16 校验值                                                       |
| 19   | End                | 1      | 固定值                  | 帧尾 `0x96`                                                         |

## 4.2 应答帧（对心跳上送，专用格式）

| 序号 | 字段名          | 字节数 | 说明                                                         |
| ---- | --------------- | ------ | ------------------------------------------------------------ |
| 1    | Sync            | 2      | 帧头 `0x5AA5`                                                |
| 2    | Packet_Length   | 2      | 仅 `Command_Status`、`Mode`、`Clocktime_Stamp` 内容长度      |
| 3    | CMD_ID          | 17     | 通信 ID                                                      |
| 4    | Frame_Type      | 1      | 帧类型                                                       |
| 5    | Packet_Type     | 1      | 报文类型：心跳应答                                           |
| 6    | Frame_No        | 1      | 回填请求帧 `Frame_No`                                        |
| 7    | Command_Status  | 1      | `0xFF` 成功；`0x00` 失败                                     |
| 8    | Mode            | 1      | `0x00` 正常模式；`0x01` 调试模式                             |
| 9    | Clocktime_Stamp | 4      | 上位机授时（`0` 表示不校时）                                 |
| 10   | CRC16           | 2      | CRC-16 校验值                                                |
| 11   | End             | 1      | 帧尾 `0x96`                                                  |

# 5) 报文类型与周期速查

| 类型       | 方向 | Packet_Type（枚举名） | Content 主字段（顺序）                                                                                                                                                                                | 默认周期      |
| -------- | -- | ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- |
| 气象 3.1   | 上送 | 气象               | `Component_ID, Time_Stamp, AvgWS10min, AvgWD10min, MaxWS, ExtremeWS, Standard_WindSpeed, Air_Temperature, Humidity, Air_Pressure, Precipitation, Precipitation_Intensity, Radiation_Intensity` | 10 min    |
| 气象应答     | 下发 | 气象应答             | `Data_Status`                                                                                                                                                                                  | —         |
| 倾斜 3.2   | 上送 | 倾斜               | `Component_ID, Time_Stamp, Inclination, Inclination_X, Inclination_Y, Angle_X, Angle_Y`                                                                                                        | 60 min    |
| 倾斜应答     | 下发 | 倾斜应答             | `Data_Status`                                                                                                                                                                                  | —         |
| 导线温度 3.5 | 上送 | 温度               | `Component_ID, Unit_Sum, Unit_No, Time_Stamp, Line_Temperature`                                                                                                                                | 10 min    |
| 温度应答     | 下发 | 温度应答             | `Data_Status`                                                                                                                                                                                  | —         |
| 心跳 6.1   | 上送 | 心跳               | `Clocktime_Stamp, Battery_Voltage, Operation_Temperature, Battery_Capacity, FloatingCharge, Total_Working_Time, Working_Time, Connection_State, Send_Flow, Receive_Flow, Protocol_Version`     | **5 min** |
| 心跳应答     | 下发 | 心跳应答             | `Command_Status, Mode, Clocktime_Stamp`                                                                                                                                                        | —         |

---


