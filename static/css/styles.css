/* ======= CSS性能优化基础 ======= */
/* 
 * 高性能CSS架构 - Linescope Server 优化版本
 * 1. GPU加速优化
 * 2. 重绘重排最小化  
 * 3. 现代CSS特性使用
 * 4. 动画性能优化
 */

/* CSS Containment API - 性能隔离 */
.card, .metric-card, .chart-card {
  contain: layout style paint;
}

.chart-canvas, .stream-container {
  contain: layout size style paint;
}

/* 全局性能优化 */
*, *::before, *::after {
  box-sizing: border-box;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* GPU加速层提升 */
.glass-effect, .hover-lift, .animate-slide-in-up {
  transform: translateZ(0);
  backface-visibility: hidden;
  perspective: 1000px;
}

/* 优化滚动性能 */
* {
  scroll-behavior: smooth;
}

@supports (overflow-anchor: auto) {
  * {
    overflow-anchor: auto;
  }
}

/* ======= 高性能CSS变量系统 ======= */
:root {
  /* 核心颜色变量 - 使用高性能的色彩值 */
  --bg: #0e1117;                    /* 页面底色 */
  --surface: rgba(18,22,30,.72);    /* 卡片玻璃背景 */
  --text: #e6e9ef;
  --muted: #a3aab7;
  --primary: #dfe3ea;
  --primary-weak: rgba(255,255,255,.06);
  --accent: #ffffff;
  --danger: #f06a6a;
  --warning: #f0c674;
  --border: rgba(255,255,255,.08);
  
  /* 优化的阴影系统 - 使用transform优化 */
  --shadow-light: 0 2px 10px rgba(0,0,0,.15);
  --shadow-medium: 0 4px 20px rgba(0,0,0,.25);
  --shadow-heavy: 0 10px 40px rgba(0,0,0,.45);
  
  /* 圆角系统 */
  --radius: 14px;
  --radius-sm: 10px;
  --radius-lg: 20px;
  --container: 1200px;
  
  /* 性能优化变量 */
  --transition-fast: 0.15s cubic-bezier(0.4, 0.0, 0.2, 1);
  --transition-normal: 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
  --transition-slow: 0.5s cubic-bezier(0.4, 0.0, 0.2, 1);
  
  /* GPU加速优化 */
  --gpu-hack: translateZ(0);
}

/* 统一背景层：图片 + 暗化渐变；不影响内容交互 */
html, body { height: 100%; }
body {
  margin: 0;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "PingFang SC","Microsoft YaHei", Arial, sans-serif;
  color: var(--text);
  /* 渐进式背景加载：从基色 -> 占位图 -> 高质量图片 */
  background: var(--bg);  /* 基础色彩，最先显示 */
  line-height: 1.65;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  position: relative;
  overflow-x: hidden;
}
body::before,
body::after{
  content:"";
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: -2;
}
/* 背景图（黑白化 + 轻对比） - 优化版本 */
body::before{
  /* 现代图像格式支持：WebP -> AVIF -> JPEG 降级 */
  background-image: 
    image-set(
      url("/static/images/images.webp") type("image/webp"),
      url("/static/images/images.avif") type("image/avif"),
      url("/static/images/images.jpg") type("image/jpeg")
    );
  /* 降级支持：老浏览器直接使用JPEG */
  background-image: url("/static/images/images.jpg");
  background-position: center center;
  background-size: cover;
  background-repeat: no-repeat;
  background-attachment: fixed; /* 视差效果 */
  filter: grayscale(100%) contrast(105%) brightness(85%);
  /* GPU加速优化 */
  will-change: transform;
  transform: translateZ(0);
}
/* 顶层暗化与轻微渐变，让内容更聚焦 */
body::after{
  z-index: -1;
  background:
    radial-gradient(1200px 800px at 20% -10%, rgba(0,0,0,.35), transparent 55%),
    linear-gradient(180deg, rgba(5,7,10,.72), rgba(5,7,10,.72));
}

/* ======= 导航、容器、基础布局（细化为黑白玻璃质感） ======= */
.container { width: 100%; max-width: var(--container); margin: 0 auto; padding: 24px; }

.header {
  position: sticky; top: 0; z-index: 50;
  background: rgba(10,14,20,.45);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--border);
}
.nav { display: flex; align-items: center; justify-content: space-between; gap: 16px; padding: 12px 24px; }
.brand { display:flex; align-items:center; gap:10px; font-weight:700; font-size:18px; }
.brand-badge{
  width: 28px; height: 28px; border-radius: 10px;
  background: linear-gradient(145deg, #6f7683, #aeb4be); /* 灰阶“金属感” */
  box-shadow: var(--shadow);
}
.nav-links{ display:flex; gap:14px; }
.nav-links a{
  padding:8px 12px; border-radius:10px; color: var(--text);
  text-decoration: none;
}
.nav-links a.active,
.nav-links a:hover{
  background: var(--primary-weak);
}

.footer{
  margin-top: 40px; padding: 24px; border-top: 1px solid var(--border);
  color: var(--muted); text-align:center;
}

/* ======= 高性能卡片玻璃化 ======= */
.card{
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow-medium);
  overflow: hidden;
  backdrop-filter: blur(10px);
  /* 性能优化 */
  contain: layout style paint;
  transform: var(--gpu-hack);
}
.card-header{ padding: 14px 18px; border-bottom: 1px solid var(--border); font-weight: 600; }
.card-body{ padding: 18px; }

/* ======= 网格 ======= */
.grid{ display:grid; grid-template-columns: repeat(12,1fr); gap:16px; }
.col-12{ grid-column: span 12; } .col-8{ grid-column: span 8; }
.col-6{ grid-column: span 6; }  .col-4{ grid-column: span 4; } .col-3{ grid-column: span 3; }
@media (max-width: 992px){
  .col-8,.col-6,.col-4{ grid-column: span 12; }
  .col-3{ grid-column: span 6; }
}

/* ======= 高性能按钮系统 ======= */
.btn{
  display:inline-flex; align-items:center; justify-content:center; gap:8px;
  padding:10px 14px; border-radius:12px;
  border: 1px solid var(--border);
  background: rgba(255,255,255,.06);
  color: var(--text); cursor:pointer;
  /* 高性能过渡效果 */
  transition: transform var(--transition-fast), background var(--transition-normal), 
              border-color var(--transition-normal), filter var(--transition-normal);
  backdrop-filter: blur(6px);
  /* GPU加速优化 */
  transform: var(--gpu-hack);
  will-change: transform;
}
.btn:hover{ 
  transform: translate3d(0, -1px, 0); 
  background: rgba(255,255,255,.10);
  box-shadow: var(--shadow-light);
}
.btn:active{ 
  transform: translate3d(0, 0, 0); 
  transition-duration: 0.05s;
}
.btn:not(:hover):not(:active) {
  will-change: auto;
}
.btn-primary{
  background: linear-gradient(135deg, #f0f0f0, #d7dbe2);
  color: #0f1216; border-color: transparent;
}
.btn-primary:hover{ filter: brightness(1.03); }
.btn-outline{ background: transparent; border-color: rgba(255,255,255,.35); color: var(--text); }
.btn-danger{ background: #c83e3e; border-color: transparent; color:#fff; }

/* 徽章 */
.badge{ display:inline-block; padding:4px 10px; font-size:12px; border-radius:999px;
  background: rgba(255,255,255,.08); color: var(--text); }
.badge-success{ background: rgba(255,255,255,.10); color:#fff; }
.badge-warn{ background: rgba(255,255,255,.10); color:#fff; }
.badge-danger{ background: rgba(255,255,255,.10); color:#fff; }

/* ======= 表格（透明玻璃） ======= */
.table-wrap{
  width:100%; overflow:auto; border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: rgba(255,255,255,.03);
  backdrop-filter: blur(6px);
}
.table{ width:100%; border-collapse:collapse; min-width:720px; }
.table thead th{
  position: sticky; top:0; z-index:1;
  background: rgba(18,22,30,.75);
  text-align:left; font-weight:700; font-size:13px; color: var(--muted);
  padding:12px 14px; border-bottom:1px solid var(--border);
  backdrop-filter: blur(6px);
}
.table tbody td{
  padding:12px 14px; border-bottom:1px solid var(--border);
  font-variant-numeric: tabular-nums;
  color: var(--text);
}
.table tbody tr:hover{ background: rgba(255,255,255,.04); }
.table tbody tr.row-alert{ background: rgba(200,62,62,.10); }

/* ======= 图表容器 ======= */
.chart-card{ height: 360px; display:flex; flex-direction:column; }
.chart-toolbar{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px; }
.chart-canvas{ flex:1; position:relative; min-height:260px; }

/* ======= 实时流容器 ======= */
.stream-container{
  position:relative; border-radius: var(--radius); overflow:hidden;
  border: 1px solid var(--border);
  background: rgba(0,0,0,.85);
  box-shadow: var(--shadow);
  backdrop-filter: blur(8px);
}
.stream-toolbar{
  position:absolute; left:12px; right:12px; top:12px;
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:8px 10px; border-radius:999px;
  background: rgba(0,0,0,.35); color:#fff; backdrop-filter: blur(8px);
}
.stream-status{ font-size:12px; display:inline-flex; align-items:center; gap:8px; }
.dot{ width:8px; height:8px; border-radius:50%; background: #fff;
  box-shadow: 0 0 0 0 rgba(255,255,255,.7); animation: pulse 1.6s infinite; }
@keyframes pulse{ 0%{box-shadow:0 0 0 0 rgba(255,255,255,.7)} 70%{box-shadow:0 0 0 10px rgba(255,255,255,0)} 100%{box-shadow:0 0 0 0 rgba(255,255,255,0)} }

/* ======= 加载骨架（弱白闪） ======= */
.skeleton{
  --sk: rgba(255,255,255,.08);
  background: linear-gradient(90deg, transparent, var(--sk), transparent);
  background-size:200% 100%; animation: shine 1.2s linear infinite; border-radius:8px;
}
@keyframes shine{ to{ background-position-x: -200%; } }

/* ======= 工具/排版 ======= */
a{ color: var(--primary); text-decoration: none; transition: all 0.2s ease; }
a:hover{ text-decoration: underline; transform: translateY(-1px); }
.text-muted{ color: var(--muted); }
.text-right{ text-align: right; }
.text-sm{ font-size:12px; }
.rounded{ border-radius: var(--radius); }
.shadow{ box-shadow: var(--shadow); }
.hero{
  margin:16px 0 24px; padding:20px; border-radius: var(--radius);
  background: rgba(255,255,255,.04);
  border: 1px solid var(--border); backdrop-filter: blur(6px);
  animation: slideInUp 0.6s ease-out;
}

/* ======= 图像性能优化 ======= */
/* 懒加载图片占位 */
.lazy-image {
  background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
  transition: opacity 0.3s ease;
  opacity: 0;
}
.lazy-image.loaded {
  opacity: 1;
}

/* 低质量图像占位符（LQIP）过渡效果 */
.image-placeholder {
  background: var(--bg);
  filter: blur(5px) brightness(0.8);
  transition: filter 0.4s ease, opacity 0.4s ease;
}
.image-placeholder.high-res-loaded {
  filter: none;
  opacity: 1;
}

/* 背景图片预加载优化 */
@media (hover: hover) {
  /* 仅在鼠标设备上预加载，节省移动设备流量 */
  body.preload-bg::before {
    background-image: url("/static/images/images-thumbnail.jpg"); /* 缩略图 */
  }
}

/* 网络连接感知优化 */
@media (prefers-reduced-data: reduce) {
  /* 节省数据模式：仅显示纯色背景 */
  body::before {
    background-image: none !important;
    background: linear-gradient(145deg, var(--bg), rgba(255,255,255,0.02));
  }
}

/* 现代图像格式降级支持 */
@supports not (background-image: image-set(url("test.webp") type("image/webp"))) {
  /* 老旧浏览器降级：直接使用JPEG，关闭视差效果避免性能问题 */
  body::before {
    background-attachment: scroll;
    background-image: url("/static/images/images.jpg");
  }
}

/* ======= 响应式设计 ======= */
/* Mobile First Approach */
@media (max-width: 576px) {
  .container { padding: 16px; }
  .nav { padding: 8px 16px; flex-wrap: wrap; }
  .nav-links { gap: 8px; }
  .nav-links a { padding: 6px 8px; font-size: 14px; }
  .brand { font-size: 16px; }
  .brand-badge { width: 24px; height: 24px; }
  .card-body { padding: 14px; }
  .card-header { padding: 12px 14px; }
  .hero { margin: 12px 0 16px; padding: 16px; }
  .btn { padding: 8px 12px; font-size: 14px; }
  .table { min-width: 600px; }
  .chart-card { height: 280px; }
  .stream-toolbar { left: 8px; right: 8px; top: 8px; }
  
  /* 移动端背景图优化：使用小尺寸图片 */
  body::before {
    background-image: 
      image-set(
        url("/static/images/images-mobile.webp") type("image/webp"),
        url("/static/images/images-mobile.jpg") type("image/jpeg")
      );
    background-image: url("/static/images/images-mobile.jpg"); /* 降级支持 */
    background-attachment: scroll; /* 移动端关闭视差效果 */
  }
}

@media (max-width: 768px) {
  .grid { grid-template-columns: 1fr; gap: 12px; }
  .col-8, .col-6, .col-4 { grid-column: span 1; }
  .chart-card { height: 300px; }
  .nav { flex-direction: column; gap: 12px; }
  .nav-links { justify-content: center; }
}

@media (max-width: 992px) {
  .col-8, .col-6, .col-4 { grid-column: span 12; }
  .col-3 { grid-column: span 6; }
}

@media (min-width: 1200px) {
  .container { max-width: 1400px; }
  .grid { gap: 24px; }
}

/* 超宽屏优化 */
@media (min-width: 1600px) {
  .container { max-width: 1600px; }
  .chart-card { height: 420px; }
  .card-body { padding: 24px; }
}

/* 打印样式 */
@media print {
  body::before, body::after { display: none; }
  .header { position: static; background: white; color: black; }
  .nav-links { display: none; }
  .btn, .stream-toolbar { display: none; }
  .card { border: 1px solid #ccc; box-shadow: none; }
  .table { color: black; }
  .chart-card { break-inside: avoid; }
}

/* 深色模式偏好设置 */
@media (prefers-color-scheme: light) {
  :root {
    --bg: #f8fafc;
    --surface: rgba(255,255,255,.9);
    --text: #1e293b;
    --muted: #64748b;
    --primary: #475569;
    --accent: #0f172a;
    --border: rgba(0,0,0,.08);
  }
  body::after {
    background: 
      radial-gradient(1200px 800px at 20% -10%, rgba(255,255,255,.35), transparent 55%),
      linear-gradient(180deg, rgba(248,250,252,.72), rgba(248,250,252,.72));
  }
}

/* 减少动画偏好设置 */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* ======= 高性能动画系统 ======= */
/* 使用GPU加速的transform属性和合成层优化 */

/* 基础动画 - 优化版本 */
@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translate3d(0, 30px, 0);
  }
  to {
    opacity: 1;
    transform: translate3d(0, 0, 0);
  }
}

@keyframes slideInDown {
  from {
    opacity: 0;
    transform: translate3d(0, -30px, 0);
  }
  to {
    opacity: 1;
    transform: translate3d(0, 0, 0);
  }
}

@keyframes slideInLeft {
  from {
    opacity: 0;
    transform: translate3d(-30px, 0, 0);
  }
  to {
    opacity: 1;
    transform: translate3d(0, 0, 0);
  }
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translate3d(30px, 0, 0);
  }
  to {
    opacity: 1;
    transform: translate3d(0, 0, 0);
  }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes fadeInScale {
  from {
    opacity: 0;
    transform: scale3d(0.95, 0.95, 1);
  }
  to {
    opacity: 1;
    transform: scale3d(1, 1, 1);
  }
}

/* 高性能弹跳动画 */
@keyframes bounceIn {
  0% {
    opacity: 0;
    transform: scale3d(0.3, 0.3, 1);
    animation-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);
  }
  20% {
    transform: scale3d(1.1, 1.1, 1);
  }
  40% {
    transform: scale3d(0.9, 0.9, 1);
  }
  60% {
    opacity: 1;
    transform: scale3d(1.03, 1.03, 1);
  }
  80% {
    transform: scale3d(0.97, 0.97, 1);
  }
  100% {
    opacity: 1;
    transform: scale3d(1, 1, 1);
  }
}

/* 优化的发光效果 - 使用filter避免layout */
@keyframes glow {
  0%, 100% {
    filter: drop-shadow(0 0 5px rgba(255,255,255,0.2));
  }
  50% {
    filter: drop-shadow(0 0 20px rgba(255,255,255,0.4));
  }
}

/* 脉冲动画 - 高性能版本 */
@keyframes pulse-efficient {
  0%, 100% {
    transform: scale3d(1, 1, 1);
    opacity: 1;
  }
  50% {
    transform: scale3d(1.05, 1.05, 1);
    opacity: 0.8;
  }
}

/* 高性能动画类 - 使用CSS变量和GPU加速 */
.animate-slide-in-up { 
  animation: slideInUp var(--transition-slow) cubic-bezier(0.4, 0.0, 0.2, 1);
  transform: var(--gpu-hack);
}
.animate-slide-in-down { 
  animation: slideInDown var(--transition-slow) cubic-bezier(0.4, 0.0, 0.2, 1);
  transform: var(--gpu-hack);
}
.animate-slide-in-left { 
  animation: slideInLeft var(--transition-slow) cubic-bezier(0.4, 0.0, 0.2, 1);
  transform: var(--gpu-hack);
}
.animate-slide-in-right { 
  animation: slideInRight var(--transition-slow) cubic-bezier(0.4, 0.0, 0.2, 1);
  transform: var(--gpu-hack);
}
.animate-fade-in { 
  animation: fadeIn var(--transition-normal) ease-out;
}
.animate-fade-in-scale { 
  animation: fadeInScale var(--transition-slow) ease-out;
  transform: var(--gpu-hack);
}
.animate-bounce-in { 
  animation: bounceIn 0.8s ease-out;
  transform: var(--gpu-hack);
}
.animate-glow { 
  animation: glow 2s ease-in-out infinite;
  will-change: filter;
}
.animate-pulse { 
  animation: pulse-efficient 1.5s ease-in-out infinite;
  transform: var(--gpu-hack);
}

/* 延迟动画 - 优化版本 */
.animate-delay-100 { animation-delay: 0.1s; }
.animate-delay-200 { animation-delay: 0.2s; }
.animate-delay-300 { animation-delay: 0.3s; }
.animate-delay-400 { animation-delay: 0.4s; }
.animate-delay-500 { animation-delay: 0.5s; }

/* 高性能悬停效果 - 使用will-change和transform */
.hover-lift {
  transition: transform var(--transition-normal), filter var(--transition-normal);
  will-change: transform, filter;
  transform: var(--gpu-hack);
}
.hover-lift:hover {
  transform: translate3d(0, -5px, 0);
  filter: drop-shadow(0 20px 40px rgba(0,0,0,0.3));
}

.hover-glow {
  transition: filter var(--transition-normal);
  will-change: filter;
}
.hover-glow:hover {
  filter: drop-shadow(0 0 15px rgba(255,255,255,0.3));
}

.hover-scale {
  transition: transform var(--transition-fast);
  will-change: transform;
  transform: var(--gpu-hack);
}
.hover-scale:hover {
  transform: scale3d(1.05, 1.05, 1);
}

/* 交互状态优化 */
.hover-lift, .hover-glow, .hover-scale {
  cursor: pointer;
}

/* 移除will-change以避免内存问题 */
.hover-lift:not(:hover),
.hover-glow:not(:hover),
.hover-scale:not(:hover) {
  will-change: auto;
}

/* 加载状态 */
.loading {
  position: relative;
  overflow: hidden;
}

.loading::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg, 
    transparent, 
    rgba(255,255,255,0.1), 
    transparent
  );
  animation: loading-shimmer 1.5s infinite;
}

@keyframes loading-shimmer {
  0% { left: -100%; }
  100% { left: 100%; }
}

/* 焦点状态增强 */
.focus-ring:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/* 滚动条美化 */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255,255,255,0.3);
}

/* Firefox 滚动条 */
html {
  scrollbar-width: thin;
  scrollbar-color: rgba(255,255,255,0.2) rgba(255,255,255,0.05);
}

/* ======= 性能监控和调试工具 ======= */
/* 开发环境下的性能调试助手 */
@media screen and (min-width: 1px) {
  /* 强制GPU加速的元素标记（开发用） */
  .debug .gpu-accelerated {
    outline: 1px solid lime !important;
  }
  
  /* 动画性能警告（开发用） */
  .debug [class*="animate-"]:not([class*="transform"]):not([class*="opacity"]) {
    outline: 2px solid red !important;
  }
}

/* 高性能工具类 */
.gpu-accelerate {
  transform: translateZ(0);
  backface-visibility: hidden;
  perspective: 1000px;
}

.optimize-repaint {
  contain: layout style paint;
}

.optimize-scroll {
  overflow-anchor: auto;
  overscroll-behavior: contain;
}

.optimize-animation {
  will-change: transform, opacity;
}

.optimize-animation.finished {
  will-change: auto;
}

/* 关键渲染路径优化 */
.above-fold {
  content-visibility: visible;
}

.below-fold {
  content-visibility: auto;
  contain-intrinsic-size: 0 200px;
}

/* 内存优化 */
.memory-efficient {
  contain: strict;
  content-visibility: auto;
}

/* 响应式优化断点 */
@media (max-width: 576px) {
  /* 移动端性能优化：减少动画复杂度 */
  .animate-glow,
  .hover-glow {
    animation: none;
    filter: none;
  }
  
  /* 减少阴影复杂度 */
  .card,
  .btn:hover {
    box-shadow: var(--shadow-light);
  }
}

@media (prefers-reduced-motion: reduce) {
  /* 无障碍访问：减少动画 */
  .animate-pulse {
    animation: none;
  }
  
  .hover-lift,
  .hover-scale {
    transform: none !important;
    transition: none !important;
  }
}
